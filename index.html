<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATI CES 2026 ANALYTICS</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-Types (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Sarabun:wght@400;700&display=swap');
        body { font-family: 'Inter', 'Sarabun', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Custom SVG Icons Component
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Database: <path d="M3 5V19C3 20.1 5.24 21 8 21C10.76 21 13 20.1 13 19V5M3 5C3 6.1 5.24 7 8 7C10.76 7 13 6.1 13 5M3 5C3 3.9 5.24 3 8 3C10.76 3 13 3.9 13 5M3 12C3 13.1 5.24 14 8 14C10.76 14 13 13.1 13 12M17 5L21 9L17 13M21 9H13" />,
                CheckCircle: <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4L12 14.01l-3-3" />,
                AlertTriangle: <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01" />,
                XCircle: <circle cx="12" cy="12" r="10" /><path d="m15 9-6 6M9 9l6 6" />,
                Search: <circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" />,
                FileText: <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><line x1="10" y1="9" x2="8" y2="9" />,
                MessageSquare: <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />,
                TrendingUp: <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" />,
                RefreshCw: <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />,
                Trash2: <polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />,
                Globe: <circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />,
                Settings: <circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />,
                AlertCircle: <circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" />,
                Info: <circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" />,
                UserCheck: <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="8.5" cy="7" r="4" /><polyline points="17 11 19 13 23 9" />,
                FilterX: <path d="M13.013 3H2l8 9.46V19l4 2v-8.54l.9-1.05" /><path d="m22 3-5 5" /><path d="m17 3 5 5" />,
                PlayCircle: <circle cx="12" cy="12" r="10" /><polygon points="10 8 16 12 10 16 10 8" />,
                ChevronRight: <polyline points="9 18 15 12 9 6" />
            };

            return (
                <svg 
                    viewBox="0 0 24 24" 
                    width={size} 
                    height={size} 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    fill="none" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {icons[name] || null}
                </svg>
            );
        };

        const COLORS = {
            'ดีเยี่ยม': '#10B981',
            'ผ่านเกณฑ์': '#3B82F6',
            'ควรปรับปรุง': '#F59E0B',
            'พบข้อผิดพลาด': '#EF4444',
            'ไม่ผ่านเกณฑ์': '#7F1D1D',
        };

        const RESULT_ORDER = ['ดีเยี่ยม', 'ผ่านเกณฑ์', 'ควรปรับปรุง', 'พบข้อผิดพลาด', 'ไม่ผ่านเกณฑ์'];

        const parseCSV = (text) => {
            const result = [];
            let row = [];
            let cell = '';
            let inQuotes = false;
            if (!text) return [];
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                if (inQuotes) {
                    if (char === '"' && nextChar === '"') { cell += '"'; i++; }
                    else if (char === '"') inQuotes = false;
                    else cell += char;
                } else {
                    if (char === '"') inQuotes = true;
                    else if (char === ',') { row.push(cell); cell = ''; }
                    else if (char === '\r' || char === '\n') {
                        row.push(cell);
                        if (row.length > 1 || row[0] !== '') result.push(row);
                        row = []; cell = '';
                        if (char === '\r' && nextChar === '\n') i++;
                    } else cell += char;
                }
            }
            if (cell || row.length > 0) { row.push(cell); result.push(row); }
            return result;
        };

        const App = () => {
            // Safe library access
            const Recharts = window.Recharts;
            if (!Recharts) return <div className="p-10 text-center font-bold">กำลังโหลดไลบรารี...</div>;

            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [sheetUrl, setSheetUrl] = useState(localStorage.getItem('qc_sheet_url') || "");
            const [searchTerm, setSearchTerm] = useState('');
            const [filterResult, setFilterResult] = useState('All');
            const [filterSup, setFilterSup] = useState('All');
            const [selectedMonth, setSelectedMonth] = useState('All');
            const [showSync, setShowSync] = useState(!localStorage.getItem('qc_sheet_url'));
            const [activeCell, setActiveCell] = useState({ agent: null, resultType: null });

            useEffect(() => {
                if (sheetUrl && sheetUrl.includes('http')) {
                    fetchFromSheet(sheetUrl);
                }
            }, [sheetUrl]);

            const fetchFromSheet = async (urlToFetch) => {
                let finalUrl = urlToFetch.trim();
                if (finalUrl.includes('docs.google.com/spreadsheets/d/') && !finalUrl.includes('pub?')) {
                    const idMatch = finalUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
                    if (idMatch) finalUrl = `https://docs.google.com/spreadsheets/d/e/${idMatch[1]}/pub?output=csv`;
                }

                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(finalUrl);
                    if (!response.ok) throw new Error("ไม่สามารถเข้าถึงไฟล์ได้ (โปรดตรวจสอบการ Publish)");
                    const csvText = await response.text();
                    if (csvText.includes('<!DOCTYPE html>')) throw new Error("ลิงก์ไม่ใช่ CSV กรุณา Publish เป็นรูปแบบ CSV");
                    
                    const allRows = parseCSV(csvText);
                    if (allRows.length < 2) throw new Error("ไม่พบข้อมูลในไฟล์");

                    let headerIdx = allRows.findIndex(row => row.some(cell => {
                        const c = cell.toString().toLowerCase();
                        return c.includes("interviewer") || c.includes("สรุปผล");
                    }));
                    
                    if (headerIdx === -1) throw new Error("ไม่พบหัวตาราง");
                    
                    const headers = allRows[headerIdx].map(h => h.trim());
                    const getIdx = (name) => headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));
                    const idx = {
                        month: getIdx("เดือน"),
                        date: getIdx("วันที่"),
                        sup: getIdx("Supervisor"),
                        agent: getIdx("Interviewer"),
                        audio: getIdx("ไฟล์เสียง"),
                        result: getIdx("สรุปผล"),
                        comment: getIdx("Comment")
                    };

                    const parsedData = allRows.slice(headerIdx + 1)
                        .filter(row => row[idx.agent]?.trim() && row[idx.agent] !== "#N/A")
                        .map((row, index) => ({
                            id: index,
                            month: row[idx.month] || 'N/A',
                            date: row[idx.date] || 'N/A',
                            supervisor: row[idx.sup] || 'N/A',
                            agent: row[idx.agent] || 'Unknown',
                            audio: row[idx.audio] || '',
                            result: row[idx.result] || 'N/A',
                            comment: row[idx.comment] || ''
                        }));

                    setData(parsedData);
                    localStorage.setItem('qc_sheet_url', finalUrl);
                    setShowSync(false);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const clearConnection = () => {
                if(window.confirm("ยกเลิกการเชื่อมต่อ?")) {
                    localStorage.removeItem('qc_sheet_url');
                    setSheetUrl(""); setData([]); setShowSync(true);
                }
            };

            const availableMonths = useMemo(() => [...new Set(data.map(d => d.month))].filter(m => m !== 'N/A'), [data]);
            const availableSups = useMemo(() => [...new Set(data.map(d => d.supervisor))].filter(s => s !== 'N/A').sort(), [data]);

            const filteredData = useMemo(() => {
                return data.filter(item => {
                    const matchesSearch = item.agent.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                         item.comment.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesResult = filterResult === 'All' || item.result.includes(filterResult);
                    const matchesSup = filterSup === 'All' || item.supervisor === filterSup;
                    const matchesMonth = selectedMonth === 'All' || item.month === selectedMonth;
                    return matchesSearch && matchesResult && matchesSup && matchesMonth;
                });
            }, [data, searchTerm, filterResult, filterSup, selectedMonth]);

            const agentSummary = useMemo(() => {
                const summaryMap = {};
                filteredData.forEach(item => {
                    if (!summaryMap[item.agent]) {
                        summaryMap[item.agent] = { name: item.agent, 'ดีเยี่ยม': 0, 'ผ่านเกณฑ์': 0, 'ควรปรับปรุง': 0, 'พบข้อผิดพลาด': 0, 'ไม่ผ่านเกณฑ์': 0, total: 0 };
                    }
                    RESULT_ORDER.forEach(res => {
                        if (item.result.includes(res)) summaryMap[item.agent][res] += 1;
                    });
                    summaryMap[item.agent].total += 1;
                });
                return Object.values(summaryMap).sort((a, b) => b.total - a.total);
            }, [filteredData]);

            const detailLogs = useMemo(() => {
                let res = filteredData;
                if (activeCell.agent && activeCell.resultType) {
                    res = res.filter(d => d.agent === activeCell.agent && d.result.includes(activeCell.resultType));
                }
                return res;
            }, [filteredData, activeCell]);

            const passRate = useMemo(() => {
                if (filteredData.length === 0) return 0;
                const passed = filteredData.filter(d => d.result.includes('ดีเยี่ยม') || d.result.includes('ผ่านเกณฑ์')).length;
                return ((passed / filteredData.length) * 100).toFixed(1);
            }, [filteredData]);

            const handleMatrixClick = (agentName, type) => {
                if (activeCell.agent === agentName && activeCell.resultType === type) {
                    setActiveCell({ agent: null, resultType: null });
                } else {
                    setActiveCell({ agent: agentName, resultType: type });
                    document.getElementById('detail-section')?.scrollIntoView({ behavior: 'smooth' });
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-900">
                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        <header className="flex flex-col lg:flex-row lg:items-center justify-between gap-4 bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-200">
                            <div className="flex items-center gap-4">
                                <div className={`p-3 rounded-[1.25rem] text-white shadow-lg transition-all ${data.length > 0 ? 'bg-indigo-600' : 'bg-slate-300'}`}>
                                    <Icon name="Database" size={28} />
                                </div>
                                <div>
                                    <h1 className="text-2xl font-black text-slate-800 uppercase tracking-tight">CATI CES 2026 ANALYTICS</h1>
                                    <div className="text-slate-500 text-xs font-bold uppercase tracking-widest flex items-center gap-2">
                                        {data.length > 0 ? <><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div> Connected: {data.length} Cases</> : "No Data Connected"}
                                    </div>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowSync(!showSync)} className="px-6 py-3 bg-indigo-600 text-white rounded-2xl text-sm font-black hover:bg-indigo-700 transition-all flex items-center gap-2 shadow-lg shadow-indigo-100">
                                    <Icon name="Settings" size={14} /> Setup
                                </button>
                                {data.length > 0 && (
                                    <button onClick={clearConnection} className="p-3 bg-red-50 text-red-500 rounded-2xl hover:bg-red-100 border border-red-100 transition-colors">
                                        <Icon name="Trash2" size={20} />
                                    </button>
                                )}
                            </div>
                        </header>

                        {(showSync || error) && (
                            <div className="p-8 bg-white rounded-[2.5rem] shadow-xl border-2 border-indigo-200 animate-in fade-in slide-in-from-top-4 duration-500">
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className="text-xl font-black text-slate-800 flex items-center gap-2 italic">
                                        <Icon name="Globe" className="text-indigo-500" /> เชื่อมต่อข้อมูล Google Sheet
                                    </h3>
                                    {data.length > 0 && <button onClick={() => setShowSync(false)} className="text-slate-400 font-bold">ปิด</button>}
                                </div>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100 text-xs space-y-2">
                                        <p className="font-bold text-slate-700 flex items-center gap-2"><Icon name="Info" size={14} className="text-blue-500"/> วิธีเอาลิงก์ CSV:</p>
                                        <ol className="list-decimal list-inside space-y-1 text-slate-500">
                                            <li>File > Share > Publish to web</li>
                                            <li>เลือก Sheet "ACQC" และรูปแบบเป็น "CSV"</li>
                                            <li>กด Publish และก๊อปปี้ลิงก์มาวาง</li>
                                        </ol>
                                    </div>
                                    <div className="flex flex-col gap-3">
                                        <input type="text" placeholder="วางลิงก์ CSV ที่นี่..." className="px-5 py-4 bg-white border border-slate-200 rounded-[1.25rem] text-sm focus:ring-2 focus:ring-indigo-500 outline-none" value={sheetUrl} onChange={(e)=>setSheetUrl(e.target.value)} />
                                        <button onClick={()=>fetchFromSheet(sheetUrl)} disabled={loading} className="px-8 py-4 bg-slate-900 text-white rounded-[1.25rem] text-sm font-black hover:bg-black transition-all disabled:bg-slate-300">
                                            {loading ? "Loading..." : "Connect Data"}
                                        </button>
                                        {error && <p className="text-xs text-red-600 font-bold flex items-center gap-1"><Icon name="AlertCircle" size={14}/> {error}</p>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {data.length > 0 && (
                            <>
                                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                    {[
                                        { label: 'Total Cases', value: filteredData.length, icon: "FileText", color: 'text-indigo-600', bg: 'bg-indigo-100' },
                                        { label: 'Pass Rate', value: `${passRate}%`, icon: "CheckCircle", color: 'text-emerald-600', bg: 'bg-emerald-100' },
                                        { label: 'Needs Improvement', value: filteredData.filter(d=>d.result.includes('ควรปรับปรุง')).length, icon: "AlertTriangle", color: 'text-orange-600', bg: 'bg-orange-100' },
                                        { label: 'Fatal Errors', value: filteredData.filter(d=>d.result.includes('พบข้อผิดพลาด')).length, icon: "XCircle", color: 'text-red-600', bg: 'bg-red-100' }
                                    ].map((kpi, i) => (
                                        <div key={i} className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm transition-all hover:scale-[1.02]">
                                            <div className={`w-8 h-8 ${kpi.bg} ${kpi.color} rounded-xl flex items-center justify-center mb-3`}><Icon name={kpi.icon} size={16} /></div>
                                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{kpi.label}</p>
                                            <h2 className={`text-3xl font-black ${kpi.color}`}>{kpi.value}</h2>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-white rounded-[3rem] shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="p-8 border-b border-slate-100 bg-slate-50/50 flex flex-col md:flex-row items-center justify-between gap-6">
                                        <h3 className="font-black text-slate-800 flex items-center gap-2 italic text-lg uppercase"><Icon name="TrendingUp" size={24} className="text-indigo-500" /> Agent Performance Matrix</h3>
                                        <div className="flex gap-2">
                                            <select className="bg-white border px-3 py-1.5 rounded-xl text-[10px] font-black outline-none shadow-sm" value={filterSup} onChange={(e)=>setFilterSup(e.target.value)}>
                                                <option value="All">All Supervisors</option>
                                                {availableSups.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select>
                                            <select className="bg-white border px-3 py-1.5 rounded-xl text-[10px] font-black outline-none shadow-sm" value={selectedMonth} onChange={(e)=>setSelectedMonth(e.target.value)}>
                                                <option value="All">All Months</option>
                                                {availableMonths.map(m => <option key={m} value={m}>{m}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left text-sm border-separate border-spacing-0">
                                            <thead className="bg-white font-black text-slate-400 text-[10px] uppercase">
                                                <tr>
                                                    <th className="px-8 py-6 border-b-2 border-slate-100 sticky left-0 bg-white z-10 border-r border-slate-50">Agent Name</th>
                                                    {RESULT_ORDER.map(type => <th key={type} className="px-4 py-4 text-center border-b-2 border-slate-100">{type}</th>)}
                                                    <th className="px-8 py-6 text-center border-b-2 border-slate-100 border-l border-slate-100 bg-slate-50">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {agentSummary.map((agent, i) => (
                                                    <tr key={i} className="hover:bg-slate-50 transition-colors group">
                                                        <td className="px-8 py-4 font-black text-slate-700 border-r border-slate-50 sticky left-0 bg-white group-hover:bg-slate-50">{agent.name}</td>
                                                        {RESULT_ORDER.map(type => {
                                                            const val = agent[type];
                                                            const isActive = activeCell.agent === agent.name && activeCell.resultType === type;
                                                            return (
                                                                <td key={type} className={`px-4 py-4 text-center border-r border-slate-50 transition-all ${val > 0 ? 'cursor-pointer hover:bg-slate-100' : ''} ${isActive ? 'bg-indigo-50 ring-2 ring-indigo-500' : ''}`} onClick={() => val > 0 && handleMatrixClick(agent.name, type)}>
                                                                    <span className="text-sm font-black" style={{ color: val > 0 ? COLORS[type] : '#e2e8f0' }}>{val || '-'}</span>
                                                                </td>
                                                            );
                                                        })}
                                                        <td className="px-8 py-4 text-center font-black bg-slate-50 group-hover:bg-indigo-50">{agent.total}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div id="detail-section" className="bg-white rounded-[3rem] shadow-sm border border-slate-200 overflow-hidden scroll-mt-6">
                                    <div className="p-8 border-b border-slate-100 flex flex-col md:flex-row items-center justify-between gap-6">
                                        <div className="flex flex-col gap-1">
                                            <h3 className="font-black text-slate-800 uppercase text-xs flex items-center gap-2 italic">
                                                <Icon name="MessageSquare" size={16} className="text-indigo-500" /> Detailed Case Logs
                                            </h3>
                                            {activeCell.agent && (
                                                <span className="text-[10px] font-black px-2 py-1 bg-indigo-100 text-indigo-700 rounded-lg flex items-center gap-2 border border-indigo-200 w-fit">
                                                    Filter: {activeCell.agent} ({activeCell.resultType})
                                                    <button onClick={() => setActiveCell({ agent: null, resultType: null })} className="hover:text-red-500"><Icon name="FilterX" size={12}/></button>
                                                </span>
                                            )}
                                        </div>
                                        <div className="relative w-full md:w-80">
                                            <Icon name="Search" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={16} />
                                            <input type="text" placeholder="Search agent or comments..." className="w-full pl-12 pr-6 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-indigo-500" value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} />
                                        </div>
                                    </div>
                                    <div className="overflow-auto max-h-[600px]">
                                        <table className="w-full text-left text-xs">
                                            <thead className="sticky top-0 bg-white border-b border-slate-100 font-black text-slate-400 uppercase z-10 shadow-sm">
                                                <tr>
                                                    <th className="px-8 py-5">Date</th>
                                                    <th className="px-8 py-5">Agent</th>
                                                    <th className="px-4 py-5 text-center">Result</th>
                                                    <th className="px-8 py-5">Comments & Recording</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {detailLogs.length > 0 ? detailLogs.slice(0, 100).map((item, idx) => (
                                                    <tr key={idx} className="hover:bg-slate-50 transition-all group">
                                                        <td className="px-8 py-5">
                                                            <div className="font-black text-slate-800">{item.date}</div>
                                                            <div className="text-[9px] text-slate-400 mt-1 uppercase">Sup: {item.supervisor}</div>
                                                        </td>
                                                        <td className="px-8 py-5 font-black text-slate-800 text-sm group-hover:text-indigo-600 transition-colors">{item.agent}</td>
                                                        <td className="px-4 py-5 text-center">
                                                            <span className="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full font-black text-[10px] shadow-sm border" style={{ backgroundColor: `${Object.entries(COLORS).find(([k,v])=>item.result.includes(k))?.[1] || '#94a3b8'}15`, color: Object.entries(COLORS).find(([k,v])=>item.result.includes(k))?.[1] || '#94a3b8', borderColor: 'transparent' }}>
                                                                {item.result}
                                                            </span>
                                                        </td>
                                                        <td className="px-8 py-5">
                                                            <p className="text-slate-500 italic line-clamp-2 group-hover:text-slate-800 transition-all">{item.comment || '-'}</p>
                                                            {item.audio && item.audio.includes('http') && (
                                                                <a href={item.audio} target="_blank" className="text-indigo-600 font-black text-[10px] mt-2 flex items-center gap-1 hover:text-indigo-800">
                                                                    <Icon name="PlayCircle" size={14}/> Play Recording
                                                                </a>
                                                            )}
                                                        </td>
                                                    </tr>
                                                )) : (
                                                    <tr><td colSpan={4} className="py-20 text-center text-slate-400 font-bold italic uppercase opacity-50">No cases found matching your criteria</td></tr>
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </>
                        )}

                        {data.length === 0 && !loading && (
                            <div className="bg-white rounded-[4rem] border-4 border-dashed border-slate-200 py-32 text-center shadow-inner">
                                <div className="bg-slate-100 w-20 h-20 rounded-[2.5rem] flex items-center justify-center mx-auto mb-6">
                                    <Icon name="Database" size={44} className="text-slate-300" />
                                </div>
                                <h2 className="text-2xl font-black text-slate-300 uppercase italic tracking-tighter">Waiting for Connection</h2>
                                <p className="text-slate-400 text-xs mt-2 uppercase font-bold tracking-widest">คลิกปุ่ม Setup ด้านบนเพื่อวางลิงก์ Google Sheets</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
